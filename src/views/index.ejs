<!DOCTYPE html>
<html lang="en">
<head>
    <title>Anime Logger</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/styles.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <div class="head-container">
        <h1>Anime Logger</h1>
        <div class="auth-buttons">
            <% if (loggedIn) { %>
                <a href="/profile">
                    <span class="username"><%= username %></span>
                    <img src="/default-avatar.jpg" alt="Profile" class="profile-image">
                </a>
            <% } else { %>
                <a href="/login"> <button type="button">Login</button> </a>
                <a href="/create-account"> <button type="button">Create Account</button> </a>
            <% } %>
        </div>
    </div>
    <div class="navigation-container">
        <div class="navigation-links">
            <a href="/list"> <button type="button">List</button> </a>
            <a href="/recommendation"> <button type="button">Recommendation</button> </a>
            <a href="/about"> <button type="button">About</button> </a>
        </div>
        <div class="search-bar">
            <input type="text" placeholder="Search.." name="search" id="search">
            <button type="button" class="search-button"><img src="MagnifyingGlass.jpg" alt="search-img" class="button-img"></button>
            <div id="search-results"></div>
        </div>
    </div>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const resultsDiv = document.getElementById('search-results');
        const searchInput = document.getElementById('search');
        // console.log("test");
        searchInput.addEventListener('input', function() {
            const query = this.value;
            if (query.length > 0) {
                fetch('/search', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ search: query })
                })
                .then(response => response.json())
                .then(data => {
                    resultsDiv.innerHTML = ''; // Clear previous results
                    if (data.results.length > 0) {
                        resultsDiv.style.display = 'block';
                        data.results.forEach(function(result) {
                            // Create a container for the result item
                            const resultItem = document.createElement('div');
                            resultItem.className = 'result-item';

                            // Add the result name
                            const nameSpan = document.createElement('span');
                            nameSpan.textContent = result.name;
                            resultItem.appendChild(nameSpan);

                            // Create the button
                            const actionButton = document.createElement('button');
                            actionButton.classList.add('list-add');
                            actionButton.innerHTML = '<span class="material-symbols-outlined">favorite</span>';
                            // actionButton.style.display = 'inline-block';
                            actionButton.addEventListener('click', function() {
                                console.log('Button clicked for ID:', result.anime_id); // debug
                            });

                            // Add the button next to the name
                            resultItem.appendChild(actionButton);

                            // Append the result item to the resultsDiv
                            resultsDiv.appendChild(resultItem);
                        });
                    } else {
                        resultsDiv.style.display = 'none';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            } else {
                resultsDiv.innerHTML = ''; // Clear results
                resultsDiv.style.display = 'none';
            }
        });
    
        document.addEventListener('click', function(event) {
            if (!event.target.closest('.search-bar')) {
                resultsDiv.style.display = 'none';
            }
        });
    
        searchInput.addEventListener('focus', function() {
            if (resultsDiv.children.length > 0) {
                resultsDiv.style.display = 'block';
            }
        });
    
        resultsDiv.addEventListener('mousedown', function(e) {
            e.stopPropagation();
        });
    });
    
    </script>
</body>
</html>
